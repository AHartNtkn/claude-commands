You are encountering a subtle bug. Your new task is to diagnose this bug. Note that your goal is *not* to fix it; just diagnose it. You will do so by repeating the following;

1. Come up with a list of likely hypotheses to explain the bug.
2. For each, brainstorm ways of falsifying each hypothesis. Your goal is to try DISPROVING your hypotheses. You may be able to disprove one by looking outside of your current scope.
3. For each hypothesis, you can: (a) add debug statements to existing code (remember to undo these changes after testing), and/or (b) create custom test files to isolate the behavior you want to test. Remember, you are NOT trying to fix the problem, just find it. NEVER make defensive changes, only exploritory ones. Make sure that you are trying to falsify your hypotheses. It's generally better to use broad, exploritory tests and debug statements (plural), rather than single or targeted ones. A full picture will spark more insights than a narrow observation.
4. Based on the results of these, update your hypotheses; either refining them, adding new ones, or removing disproven ones.
5. Repeat until you have a firm, concrete, and mechanical explanation for the bug. This means you must be able to give a step-by-step walkthrough of exactly what's happening algorithmically, and pointing out exactly where something goes wrong. You should be able to say "at this step, we expect X, but instead we get Y", and fully trace, step-by-step, how that leads to the observed bug.
6. When you've reached your conclusion, create a minimal, isolated demonstration of the bug. Run that example, and, using the debug outputs as guides, create a step-by-step explanation of it. If, in the course of this explanation, you realized you're wrong, START OVER! Reset your todo list, DO NOT CHECK OFF ANYGHING! DO NOT DECLARE A CONCLUSION UNTIL YOU'VE FULLY TRACED AN INSTANCE OF THE BUG! This minimal example has to be an actual program that you wrote, which explicitly calls specific library functions, in sequence, and this sequence must recapitulate the logic on the program and identify the bug.

Do NOT leave anything to speculation. If you believe that something is likely, test it to make sure. If you think something may be the case, test it to make sure. Youre goal is to gain knowledge and certainty. If you are preparing your conclusion, and it has word like "likely" or "suggests" or "may be" or any other hedging words, admit you didn't actually reach a conclusion instead of finishing. You HAVE NOT reached a conclusion and you must continue hypothesis testing. This is EXTREMELY IMPORTANT! DO NOT FORGET THIS!

After you are done, report back with your findings and a full explanation for the bug.
